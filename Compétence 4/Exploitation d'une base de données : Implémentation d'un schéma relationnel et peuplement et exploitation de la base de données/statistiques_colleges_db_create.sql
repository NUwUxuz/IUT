CREATE SCHEMA college;
SET SCHEMA 'college';


CREATE TABLE _region (
    code_region VARCHAR(50) NOT NULL,
    libelle_region VARCHAR(50) NOT NULL,
    CONSTRAINT _region_pk PRIMARY KEY (code_region)
);


CREATE TABLE _departement (
    code_du_departement VARCHAR(50) NOT NULL,
    nom_departement VARCHAR(50) NOT NULL,
    code_region VARCHAR(50) NOT NULL,
    CONSTRAINT _departement_pk PRIMARY KEY (code_du_departement),
    CONSTRAINT _departement_fk FOREIGN KEY (code_region) REFERENCES _region(code_region)
);


CREATE TABLE _commune (
    code_insee_de_la_commune VARCHAR(50) NOT NULL,
    nom_de_la_commune VARCHAR(50) NOT NULL,
    code_du_departement VARCHAR(50) NOT NULL,
    CONSTRAINT _commune_pk PRIMARY KEY (code_insee_de_la_commune),
    CONSTRAINT _commune_fk FOREIGN KEY (code_du_departement) REFERENCES _departement(code_du_departement)
);


CREATE TABLE _academie (
    code_academie INT,
    lib_academie VARCHAR(50) NOT NULL,
    code_region VARCHAR(50) NOT NULL,
    CONSTRAINT _academie_pk PRIMARY KEY (code_academie)
);



CREATE TABLE _quartier_prioritaire (
    code_quartier_prioritaire VARCHAR(50) NOT NULL,
    nom_quartier_prioritaire VARCHAR(50) NOT NULL,
    CONSTRAINT _quartier_prioritaire_pk PRIMARY KEY (code_quartier_prioritaire)
);


CREATE TABLE _type (
    code_nature VARCHAR(50) NOT NULL,
    libelle_nature VARCHAR(50) NOT NULL,
    CONSTRAINT _type_pk PRIMARY KEY (code_nature)
);



CREATE TABLE _etablissement (
    uai VARCHAR(50) NOT NULL,
    nom_etablissement VARCHAR(50) NOT NULL,
    secteur VARCHAR(50) NOT NULL,
    code_postal VARCHAR(50) NOT NULL,
    latitude FLOAT,
    longitude FLOAT,
    code_insee_de_la_commune VARCHAR(50) NOT NULL,
    code_academie INT,
    code_nature VARCHAR(50) NOT NULL,
    CONSTRAINT _etablissement_pk PRIMARY KEY (uai),
    CONSTRAINT _etablissement_fk1 FOREIGN KEY (code_insee_de_la_commune) REFERENCES _commune(code_insee_de_la_commune),
    CONSTRAINT _etablissement_fk2 FOREIGN KEY (code_academie) REFERENCES _academie(code_academie),
    CONSTRAINT _etablissement_fk3 FOREIGN KEY (code_nature) REFERENCES _type(code_nature)
);


CREATE TABLE _est_a_proximite_de (
    uai VARCHAR(50) NOT NULL,
    code_quartier_prioritaire VARCHAR(50) NOT NULL,
    CONSTRAINT _est_a_proximite_de_pk PRIMARY KEY (uai, code_quartier_prioritaire),
    CONSTRAINT _est_a_proximite_de_fk1 FOREIGN KEY (uai) REFERENCES _etablissement(uai),
    CONSTRAINT _est_a_proximote_de_fk2 FOREIGN KEY (code_quartier_prioritaire) REFERENCES _quartier_prioritaire(code_quartier_prioritaire)
);


CREATE TABLE _annee (
    annee_scolaire VARCHAR(50) NOT NULL,
    CONSTRAINT _annee_pk PRIMARY KEY (annee_scolaire)
);


CREATE TABLE _classe (
    id_classe VARCHAR(50) NOT NULL,
    CONSTRAINT _classe_pk PRIMARY KEY (id_classe)
);


CREATE TABLE _car_tout_etablissement (
    effectifs INT,
    ips FLOAT,
    ecart_type_de_l_ips FLOAT,
    ep VARCHAR(50) NOT NULL,
    uai VARCHAR(50) NOT NULL,
    annee_scolaire VARCHAR(50) NOT NULL,
    CONSTRAINT _car_tout_etablissement_pk PRIMARY KEY (uai, annee_scolaire),
    CONSTRAINT _car_tout_etablissement_fk1 FOREIGN KEY (uai) REFERENCES _etablissement(uai),
    CONSTRAINT _car_tout_etablissement_fk2 FOREIGN KEY (annee_scolaire) REFERENCES _annee(annee_scolaire)
);


CREATE TABLE _car_college (
    nbre_eleves_hors_sepa_hors_ulis INT,
    nbre_eleves_segpa INT,
    nbre_eleves_ulis INT,
    uai VARCHAR(50) NOT NULL,
    annee_scolaire VARCHAR(50) NOT NULL,
    CONSTRAINT _car_college_pk PRIMARY KEY (uai, annee_scolaire),
    CONSTRAINT _car_college_fk1 FOREIGN KEY (uai) REFERENCES _etablissement(uai),
    CONSTRAINT _car_college_fk2 FOREIGN KEY (annee_scolaire) REFERENCES _annee(annee_scolaire)
);


CREATE TABLE _car_selon_classe (
    nbre_eleves_hors_sepa_hors_ulis_selon_niveau INT,
    nbre_eleves_segpa_selon_niveau INT,
    nbre_eleves_ulis_selon_niveau INT,
    effectif_filles INT,
    effectif_garcons INT,
    uai VARCHAR(50) NOT NULL,
    id_classe VARCHAR(50) NOT NULL,
    annee_scolaire VARCHAR(50) NOT NULL,
    CONSTRAINT _car_selon_classe_pk PRIMARY KEY (uai, id_classe, annee_scolaire),
    CONSTRAINT _car_selon_classe_fk1 FOREIGN KEY (uai) REFERENCES _etablissement(uai),
    CONSTRAINT _car_selon_classe_fk2 FOREIGN KEY (id_classe) REFERENCES _classe(id_classe),
    CONSTRAINT _car_selon_classe_fk3 FOREIGN KEY (annee_scolaire) REFERENCES _annee(annee_scolaire)
);
